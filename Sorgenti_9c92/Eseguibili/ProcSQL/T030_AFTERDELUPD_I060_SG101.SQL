CREATE OR REPLACE TRIGGER T030_AFTERDELUPD_I060_SG101
  after update or delete on T030_ANAGRAFICO
  for each row
declare
begin
  if updating then
    if :OLD.MATRICOLA <> :NEW.MATRICOLA then
      update MONDOEDP.I060_LOGIN_DIPENDENTE set MATRICOLA = :NEW.MATRICOLA
      where MATRICOLA = :OLD.MATRICOLA
      and AZIENDA = (select min(AZIENDA) from MONDOEDP.I090_ENTI where UTENTE = (select USERNAME from USER_USERS));
      UPDATE SG101_FAMILIARI SET MATRICOLA = :NEW.MATRICOLA
      WHERE MATRICOLA = :OLD.MATRICOLA;
    end if;  
    if :OLD.DATANAS <> :NEW.DATANAS then
      UPDATE SG101_FAMILIARI SET DATANAS = :NEW.DATANAS
      WHERE MATRICOLA = :NEW.MATRICOLA;
    end if;    
  elsif deleting then
    delete from MONDOEDP.I061_PROFILI_DIPENDENTE
    where NOME_UTENTE in (select NOME_UTENTE from MONDOEDP.I060_LOGIN_DIPENDENTE where MATRICOLA = :OLD.MATRICOLA)
    and AZIENDA = (select min(AZIENDA) from MONDOEDP.I090_ENTI where UTENTE = (select USERNAME from USER_USERS));
    delete from MONDOEDP.I060_LOGIN_DIPENDENTE
    where MATRICOLA = :OLD.MATRICOLA
    and AZIENDA = (select min(AZIENDA) from MONDOEDP.I090_ENTI where UTENTE = (select USERNAME from USER_USERS));
  end if;
exception
  when others then null;
end T030_AFTERDELUPD_I060_SG101;
/
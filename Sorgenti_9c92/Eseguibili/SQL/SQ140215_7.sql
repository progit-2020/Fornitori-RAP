declare
  i integer;
begin
  select COUNT(*) into i from P042_ENTIIRPEF;
  if i = 0 then
    insert into I050_SCRIPTSQL (NOME) values ('SQ140215_7AddIRPEF.sql');
  end if;
exception
  when others then
    insert into I050_SCRIPTSQL (NOME) values ('SQ140215_7AddIRPEF.sql');
end/*--NOLOG--*/;
/
-- *****************************************************************************
-- CREAZIONE VOCE 15067 Distacco sindacale retribuito 25%
-- *****************************************************************************

declare 
  i integer;
  ID_P200 integer;
  CodVoceModello varchar2(5);
  CodVoceCopia varchar2(5);
  DesVoceCopia varchar2(40);

begin
  CodVoceModello:='15070';
  CodVoceCopia:='15067';
  DesVoceCopia:='Distacco sindacale retribuito 25%';

select COUNT(*) into i from P441_CEDOLINO;
if i > 0 then
  select COUNT(*) into i from P200_VOCI t 
    where T.COD_CONTRATTO IN('EDP','EDPEL') and T.COD_VOCE=CodVoceModello and T.COD_VOCE_SPECIALE='BASE'
    and not exists
    (select 'X' from P200_VOCI v where v.cod_contratto=t.cod_contratto and v.cod_voce=CodVoceCopia
       and v.cod_voce_speciale=t.cod_voce_speciale);
  if i > 0 then
  
-----
-- Creazione voce copiandola da 15070
-----

SELECT P200_ID_VOCE.NEXTVAL INTO ID_P200 FROM DUAL;
  
insert into p200_voci
select cod_contratto, CodVoceCopia, cod_voce_speciale, decorrenza, ID_P200, DesVoceCopia, CodVoceCopia || ' ', DesVoceCopia, protetta, tipo, rid_mese_ass_cess, cassa_competenza, voce_importo, importo_automatico, importo_automatico_tipo, importo, importo_colonna, voce_quantita, cod_misuraquantita, ritenuta_massimali_scaglioni, ritenuta_perc, imponibile_minimali, cod_arrotondamento, perc_matura13a, mostra_video, confronto_mensile, stampa_cedolino, stampa_competenza, stampa_competenza_quote, cod_causaleirpef, ridotta_parttime_vert, ridotta_parttime_orizz, no_cedolino_normale, forza_ggcalcolo_quote, abbatte_ggminimali, abbatte_ggdetraz_caricofam, abbatte_ggdetraz_lavdip, abbatte_gganf, cumulo_annuale_cedolone, cod_raggruppamento, 75, note, cumulo_in_calcolo, cod_voce_link_assog, cod_voce_speciale_link_assog, divisore_quote, abbatte_gginp, abbatte_ggina, programmata, oneri_detrazioni, eccezioni_sensibili, cod_raggruppamento_assogg, retribuzione_contrattuale, ritenuta_anagrafica, decorrenza_fine, cod_beneficiario, importo_massimo from p200_voci T
WHERE T.COD_CONTRATTO IN('EDP','EDPEL') AND T.COD_VOCE=CodVoceModello AND T.COD_VOCE_SPECIALE='BASE';

-- Quote
INSERT INTO P205_QUOTE
SELECT COD_CONTRATTO, CodVoceCopia, COD_VOCE_SPECIALE_DA_QUOTARE, COD_VOCE_IN_QUOTA, COD_VOCE_SPECIALE_IN_QUOTA, DECORRENZA, -75, ACCUMULO_RATEO, COD_VOCE_SPECIALE_DETTAGLIO, COD_VOCE_SPECIALE_DETTAGLIO13A  FROM P205_QUOTE T
WHERE T.COD_CONTRATTO IN('EDP','EDPEL') AND T.COD_VOCE_DA_QUOTARE=CodVoceModello AND T.COD_VOCE_SPECIALE_DA_QUOTARE='BASE';

-- Assenze INPDAP
INSERT INTO P206_ASSENZEINPDAP 
SELECT COD_CONTRATTO, CodVoceCopia, COD_VOCE_SPECIALE, DECORRENZA, ELIMINA_SEZIONE, ABBATTE_GGUTILI, COD_TIPOSERVIZIO, COD_GESTASSIC_NONCOPERTE, COD_CAUSASOSPENSIONE, 75, perc_retribuzione, note, decorrenza_fine FROM P206_ASSENZEINPDAP T
WHERE T.COD_CONTRATTO IN('EDP','EDPEL') AND T.COD_VOCE=CodVoceModello AND T.COD_VOCE_SPECIALE ='BASE';

  end if;
end if;
end;
/

-----
-- Inizio creazione voce EDP 00018 15070
-----

declare 
  i integer;
  ID_P200 integer;
  DesVoceCopia varchar2(40);
  DesVoceCopiaSt varchar2(40);

begin
DesVoceCopia:='Riduzione per distacco sindacale';
DesVoceCopiaSt:='Riduzione per distacco sindacale';

select COUNT(*) into i from P441_CEDOLINO;
if i > 0 then
  select COUNT(*) into i from P200_VOCI t 
    where T.COD_CONTRATTO ='EDP' and T.COD_VOCE='00018' and T.COD_VOCE_SPECIALE='BASE'
    and not exists
    (select 'X' from P200_VOCI v where v.cod_contratto=t.cod_contratto and v.cod_voce=t.cod_voce
       and v.cod_voce_speciale='15070');
  if i > 0 then

  
SELECT P200_ID_VOCE.NEXTVAL INTO ID_P200 FROM DUAL;
  
insert into p200_voci
select cod_contratto, cod_voce, '15070', decorrenza, ID_P200, DesVoceCopia, cod_voce_stampa, DesVoceCopiaSt, protetta, tipo, rid_mese_ass_cess, cassa_competenza, voce_importo, importo_automatico, importo_automatico_tipo, importo, importo_colonna, voce_quantita, cod_misuraquantita, ritenuta_massimali_scaglioni, ritenuta_perc, imponibile_minimali, cod_arrotondamento, perc_matura13a, mostra_video, confronto_mensile, stampa_cedolino, stampa_competenza, stampa_competenza_quote, cod_causaleirpef, ridotta_parttime_vert, ridotta_parttime_orizz, no_cedolino_normale, forza_ggcalcolo_quote, abbatte_ggminimali, abbatte_ggdetraz_caricofam, abbatte_ggdetraz_lavdip, abbatte_gganf, cumulo_annuale_cedolone, cod_raggruppamento, perc_abbatte13a, note, cumulo_in_calcolo, cod_voce_link_assog, cod_voce_speciale_link_assog, divisore_quote, abbatte_gginp, abbatte_ggina, programmata, oneri_detrazioni, eccezioni_sensibili, cod_raggruppamento_assogg, retribuzione_contrattuale, ritenuta_anagrafica, decorrenza_fine, cod_beneficiario, importo_massimo from p200_voci T
WHERE T.COD_CONTRATTO='EDP' AND T.COD_VOCE='00018' AND T.COD_VOCE_SPECIALE='15030';

INSERT INTO P201_ASSOGGETTAMENTI
select cod_contratto, cod_voce_padre, '15070', cod_voce_figlio, cod_voce_speciale_figlio, decorrenza, assoggettamento, assoggettamento13a, decorrenza_fine from p201_assoggettamenti t
where T.COD_CONTRATTO='EDP' and t.cod_voce_padre='00018' and t.cod_voce_speciale_padre='15030';

insert into p201_assoggettamenti
  (cod_contratto, cod_voce_padre, cod_voce_speciale_padre, cod_voce_figlio, cod_voce_speciale_figlio, decorrenza, assoggettamento, assoggettamento13a, decorrenza_fine)
values
  ('EDP', '00018', '15070', '14100', 'BASE', TO_DATE('01011900','DDMMYYYY'), 100, 100, TO_DATE('31123999','DDMMYYYY'));

INSERT INTO P216_ACCORPAMENTOVOCI
select cod_contratto, cod_voce, '15070', cod_tipoaccorpamentovoci, cod_codiciaccorpamentovoci, decorrenza, percentuale, importo_colonna, decorrenza_fine from p216_accorpamentovoci T
where T.COD_CONTRATTO='EDP' and t.cod_voce='00018' and t.cod_voce_speciale='15030';

INSERT INTO P205_QUOTE
select cod_contratto, cod_voce_da_quotare, cod_voce_speciale_da_quotare, '00018', cod_voce_speciale_in_quota, decorrenza, accumulo, accumulo_rateo, cod_voce_speciale_dettaglio, cod_voce_speciale_dettaglio13a
from p205_quote t 
where t.cod_contratto='EDP' and t.cod_voce_speciale_da_quotare='BASE' and t.cod_voce_in_quota='00010'
and t.cod_voce_speciale_in_quota='BASE' and t.cod_voce_speciale_dettaglio='15070';

  end if;

end if;
end;

/

-----
-- Fine creazione voce EDP 00018 15070
-----

UPDATE p258_addizionaliirpef t SET T.IMPORTO_TOTALE=ROUND(T.IMPORTO_TOTALE,2)
WHERE T.IMPORTO_TOTALE<>ROUND(T.IMPORTO_TOTALE,2) AND T.ANNO=2014;

UPDATE p258_addizionaliirpef t SET T.IMPONIBILE=ROUND(T.IMPONIBILE,2)
WHERE T.IMPONIBILE<>ROUND(T.IMPONIBILE,2) AND T.ANNO=2014;

UPDATE p258_addizionaliirpef t SET T.IMPORTO_TOTALE_CALCOLATO=ROUND(T.IMPORTO_TOTALE_CALCOLATO,2)
WHERE T.IMPORTO_TOTALE_CALCOLATO<>ROUND(T.IMPORTO_TOTALE_CALCOLATO,2) AND T.ANNO=2014;

UPDATE p258_addizionaliirpef t SET T.IMPONIBILE_CALCOLATO=ROUND(T.IMPONIBILE_CALCOLATO,2)
WHERE T.IMPONIBILE_CALCOLATO<>ROUND(T.IMPONIBILE_CALCOLATO,2) AND T.ANNO=2014;

insert into t480_comuni
select '018191','CORNALE E BASTIDA','27056','PV','M338' from dual
where not exists
(select * from T480_COMUNI t where t.codcatastale='M338');

UPDATE T480_COMUNI T480 SET T480.CITTA='SAN MARTINO SULLA MARRUCINA' WHERE T480.CODCATASTALE='H991';  
UPDATE T480_COMUNI T480 SET T480.CITTA='SAN MARTINO AL TAGLIAMENTO' WHERE T480.CODCATASTALE='H999';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAN MARZANO DI SAN GIUSEPPE' WHERE T480.CODCATASTALE='I018';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAN MICHELE AL TAGLIAMENTO' WHERE T480.CODCATASTALE='I040';
UPDATE T480_COMUNI T480 SET T480.CITTA='ALBISSOLA MARINA' WHERE T480.CODCATASTALE='A165';
UPDATE T480_COMUNI T480 SET T480.CITTA='BRENZONE SUL GARDA' WHERE T480.CODCATASTALE='B154';
UPDATE T480_COMUNI T480 SET T480.CITTA='CADERZONE TERME' WHERE T480.CODCATASTALE='B335';
UPDATE T480_COMUNI T480 SET T480.CITTA='CALATAFIMI SEGESTA' WHERE T480.CODCATASTALE='B385';
UPDATE T480_COMUNI T480 SET T480.CITTA='CASTELVECCHIO DI ROCCA BARBENA' WHERE T480.CODCATASTALE='C276';
UPDATE T480_COMUNI T480 SET T480.CITTA='VILLA SANTA LUCIA DEGLI ABRUZZI' WHERE T480.CODCATASTALE='M021';
UPDATE T480_COMUNI T480 SET T480.CITTA='CASTELVETERE IN VAL FORTORE' WHERE T480.CODCATASTALE='C284';
UPDATE T480_COMUNI T480 SET T480.CITTA='CASTIGLIONE DEL GENOVESI' WHERE T480.CODCATASTALE='C306';
UPDATE T480_COMUNI T480 SET T480.CITTA='CASTIGLIONE DELLE STIVIERE' WHERE T480.CODCATASTALE='C312';
UPDATE T480_COMUNI T480 SET T480.CITTA='CASTIGLIONE MESSER RAIMONDO' WHERE T480.CODCATASTALE='C316';
UPDATE T480_COMUNI T480 SET T480.CITTA='CASTRONOVO DI SICILIA' WHERE T480.CODCATASTALE='C344';
UPDATE T480_COMUNI T480 SET T480.CITTA='JESOLO' WHERE T480.CODCATASTALE='C388';
UPDATE T480_COMUNI T480 SET T480.CITTA='CEGLIE MESSAPICA' WHERE T480.CODCATASTALE='C424';
UPDATE T480_COMUNI T480 SET T480.CITTA='CERRINA MONFERRATO' WHERE T480.CODCATASTALE='C531';
UPDATE T480_COMUNI T480 SET T480.CITTA='CIVITELLA IN VAL DI CHIANA' WHERE T480.CODCATASTALE='C774';
UPDATE T480_COMUNI T480 SET T480.CITTA='CORTE DE'' CORTESI CON CIGNONE' WHERE T480.CODCATASTALE='D056';
UPDATE T480_COMUNI T480 SET T480.CITTA='CODRONGIANOS' WHERE T480.CODCATASTALE='C818';
UPDATE T480_COMUNI T480 SET T480.CITTA='CORTENUOVA' WHERE T480.CODCATASTALE='D066';
UPDATE T480_COMUNI T480 SET T480.CITTA='COSTA SERINA' WHERE T480.CODCATASTALE='D111';
UPDATE T480_COMUNI T480 SET T480.CITTA='GALLO MATESE' WHERE T480.CODCATASTALE='D884';
UPDATE T480_COMUNI T480 SET T480.CITTA='GARNIGA TERME' WHERE T480.CODCATASTALE='D928';
UPDATE T480_COMUNI T480 SET T480.CITTA='GODIASCO SALICE TERME' WHERE T480.CODCATASTALE='E072';
UPDATE T480_COMUNI T480 SET T480.CITTA='GRIZZANA MORANDI' WHERE T480.CODCATASTALE='E187';
UPDATE T480_COMUNI T480 SET T480.CITTA='GRUMELLO CREMONESE ED UNITI' WHERE T480.CODCATASTALE='E217';
UPDATE T480_COMUNI T480 SET T480.CITTA='LECCE NEI MARSI' WHERE T480.CODCATASTALE='E505';
UPDATE T480_COMUNI T480 SET T480.CITTA='LIVINALLONGO DEL COL DI LANA' WHERE T480.CODCATASTALE='E622';
UPDATE T480_COMUNI T480 SET T480.CITTA='MILITELLO IN VAL DI CATANIA' WHERE T480.CODCATASTALE='F209';
UPDATE T480_COMUNI T480 SET T480.CITTA='MONTEBELLO DELLA BATTAGLIA' WHERE T480.CODCATASTALE='F440';
UPDATE T480_COMUNI T480 SET T480.CITTA='MONTE COMPATRI' WHERE T480.CODCATASTALE='F477';
UPDATE T480_COMUNI T480 SET T480.CITTA='MONTEFALCONE DI VAL FORTORE' WHERE T480.CODCATASTALE='F494';
UPDATE T480_COMUNI T480 SET T480.CITTA='MONTE GRIMANO TERME' WHERE T480.CODCATASTALE='F524';
UPDATE T480_COMUNI T480 SET T480.CITTA='MONTE SAN GIOVANNI IN SABINA' WHERE T480.CODCATASTALE='F619';
UPDATE T480_COMUNI T480 SET T480.CITTA='MONTE SAN GIOVANNI CAMPANO' WHERE T480.CODCATASTALE='F620';
UPDATE T480_COMUNI T480 SET T480.CITTA='MONTESANO SULLA MARCELLANA' WHERE T480.CODCATASTALE='F625';
UPDATE T480_COMUNI T480 SET T480.CITTA='MONTE SANTA MARIA TIBERINA' WHERE T480.CODCATASTALE='F629';
UPDATE T480_COMUNI T480 SET T480.CITTA='NOCERA TERINESE' WHERE T480.CODCATASTALE='F910';
UPDATE T480_COMUNI T480 SET T480.CITTA='PAGANICO SABINO' WHERE T480.CODCATASTALE='G232';
UPDATE T480_COMUNI T480 SET T480.CITTA='PETTORAZZA GRIMANI' WHERE T480.CODCATASTALE='G525';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAN BENEDETTO VAL DI SAMBRO' WHERE T480.CODCATASTALE='G566';
UPDATE T480_COMUNI T480 SET T480.CITTA='PINO SULLA SPONDA DEL LAGO MAGGIORE' WHERE T480.CODCATASTALE='G677';
UPDATE T480_COMUNI T480 SET T480.CITTA='PUEGNAGO DEL GARDA' WHERE T480.CODCATASTALE='H086';
UPDATE T480_COMUNI T480 SET T480.CITTA='REANA DEL ROJALE' WHERE T480.CODCATASTALE='H206';
UPDATE T480_COMUNI T480 SET T480.CITTA='REGGIO DI CALABRIA' WHERE T480.CODCATASTALE='H224';
UPDATE T480_COMUNI T480 SET T480.CITTA='RICCO'' DEL GOLFO DI SPEZIA' WHERE T480.CODCATASTALE='H275';
UPDATE T480_COMUNI T480 SET T480.CITTA='RONCEGNO TERME' WHERE T480.CODCATASTALE='H528';
UPDATE T480_COMUNI T480 SET T480.CITTA='RUFFRE''-MENDOLA' WHERE T480.CODCATASTALE='H634';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAINT-RHEMY-EN-BOSSES' WHERE T480.CODCATASTALE='H675';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAN BARTOLOMEO VAL CAVARGNA' WHERE T480.CODCATASTALE='H760';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAN CASCIANO IN VAL DI PESA' WHERE T480.CODCATASTALE='H791';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAN GIACOMO DEGLI SCHIAVONI' WHERE T480.CODCATASTALE='H867';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAN GIORGIO DELLE PERTICHE' WHERE T480.CODCATASTALE='H893';
UPDATE T480_COMUNI T480 SET T480.CITTA='VILLA SAN GIOVANNI IN TUSCIA' WHERE T480.CODCATASTALE='H913';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAN MARTINO DALL''ARGINE' WHERE T480.CODCATASTALE='I005';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAN POLO MATESE' WHERE T480.CODCATASTALE='I122';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANTA CATERINA DELLO IONIO' WHERE T480.CODCATASTALE='I170';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANTA CRISTINA D''ASPROMONTE' WHERE T480.CODCATASTALE='I176';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANT''AGATA DE'' GOTI' WHERE T480.CODCATASTALE='I197';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANT''ALESSIO IN ASPROMONTE' WHERE T480.CODCATASTALE='I214';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANTA MARGHERITA DI BELICE' WHERE T480.CODCATASTALE='I224';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANTA MARGHERITA DI STAFFORA' WHERE T480.CODCATASTALE='I230';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANT''AMBROGIO SUL GARIGLIANO' WHERE T480.CODCATASTALE='I256';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANT''ANDREA DEL GARIGLIANO' WHERE T480.CODCATASTALE='I265';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANT''ANDREA APOSTOLO DELLO IONIO' WHERE T480.CODCATASTALE='I266';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANT''ANGELO DI PIOVE DI SACCO' WHERE T480.CODCATASTALE='I275';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANTA VITTORIA IN MATENANO' WHERE T480.CODCATASTALE='I315';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANT''EGIDIO DEL MONTE ALBINO' WHERE T480.CODCATASTALE='I317';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAN TOMASO AGORDINO' WHERE T480.CODCATASTALE='I347';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANT''OMOBONO TERME' WHERE T480.CODCATASTALE='I349';
UPDATE T480_COMUNI T480 SET T480.CITTA='SANT''ORSOLA TERME' WHERE T480.CODCATASTALE='I354';
UPDATE T480_COMUNI T480 SET T480.CITTA='TELESE TERME' WHERE T480.CODCATASTALE='L086';
UPDATE T480_COMUNI T480 SET T480.CITTA='TORRE BERETTI E CASTELLARO' WHERE T480.CODCATASTALE='L250';
UPDATE T480_COMUNI T480 SET T480.CITTA='TREMOSINE SUL GARDA' WHERE T480.CODCATASTALE='L372';
UPDATE T480_COMUNI T480 SET T480.CITTA='TRINITA'' D''AGULTU E VIGNOLA' WHERE T480.CODCATASTALE='L428';
UPDATE T480_COMUNI T480 SET T480.CITTA='VILLAFRANCA IN LUNIGIANA' WHERE T480.CODCATASTALE='L946';
UPDATE T480_COMUNI T480 SET T480.CITTA='VILLANOVA DI CAMPOSAMPIERO' WHERE T480.CODCATASTALE='L979';
UPDATE T480_COMUNI T480 SET T480.CITTA='VILLANOVA TULO' WHERE T480.CODCATASTALE='L992';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAN FERDINANDO' WHERE T480.CODCATASTALE='M277';
UPDATE T480_COMUNI T480 SET T480.CITTA='AQUILA D''ARROSCIA' WHERE T480.CODCATASTALE='A344';
UPDATE T480_COMUNI T480 SET T480.CITTA='BELVI''' WHERE T480.CODCATASTALE='A776';
UPDATE T480_COMUNI T480 SET T480.CITTA='CASSANO ALL''IONIO' WHERE T480.CODCATASTALE='C002';
UPDATE T480_COMUNI T480 SET T480.CITTA='CASTRONUOVO DI SANT''ANDREA' WHERE T480.CODCATASTALE='C345';
UPDATE T480_COMUNI T480 SET T480.CITTA='COSIO D''ARROSCIA' WHERE T480.CODCATASTALE='D087';
UPDATE T480_COMUNI T480 SET T480.CITTA='DONORI' WHERE T480.CODCATASTALE='D344';
UPDATE T480_COMUNI T480 SET T480.CITTA='GALTELLI''' WHERE T480.CODCATASTALE='D888';
UPDATE T480_COMUNI T480 SET T480.CITTA='LEINI' WHERE T480.CODCATASTALE='E518';
UPDATE T480_COMUNI T480 SET T480.CITTA='MAGLIANO DE'' MARSI' WHERE T480.CODCATASTALE='E811';
UPDATE T480_COMUNI T480 SET T480.CITTA='ONANI''' WHERE T480.CODCATASTALE='G064';
UPDATE T480_COMUNI T480 SET T480.CITTA='SODDI''' WHERE T480.CODCATASTALE='I778';
UPDATE T480_COMUNI T480 SET T480.CITTA='STALETTI''' WHERE T480.CODCATASTALE='I937';
UPDATE T480_COMUNI T480 SET T480.CITTA='TERZO DI AQUILEIA' WHERE T480.CODCATASTALE='L144';
UPDATE T480_COMUNI T480 SET T480.CITTA='TOCCO DA CASAURIA' WHERE T480.CODCATASTALE='L186';
UPDATE T480_COMUNI T480 SET T480.CITTA='VO''' WHERE T480.CODCATASTALE='M103';
UPDATE T480_COMUNI T480 SET T480.CITTA='BELLARIA-IGEA MARINA' WHERE T480.CODCATASTALE='A747';
UPDATE T480_COMUNI T480 SET T480.CITTA='BRISSAGO-VALTRAVAGLIA' WHERE T480.CODCATASTALE='B191';
UPDATE T480_COMUNI T480 SET T480.CITTA='BOVISIO-MASCIAGO' WHERE T480.CODCATASTALE='B105';
UPDATE T480_COMUNI T480 SET T480.CITTA='CADEGLIANO-VICONAGO' WHERE T480.CODCATASTALE='B326';
UPDATE T480_COMUNI T480 SET T480.CITTA='CASALE CREMASCO-VIDOLASCO' WHERE T480.CODCATASTALE='B881';
UPDATE T480_COMUNI T480 SET T480.CITTA='CASTELLO-MOLINA DI FIEMME' WHERE T480.CODCATASTALE='C189';
UPDATE T480_COMUNI T480 SET T480.CITTA='CHALLAND-SAINT-ANSELME' WHERE T480.CODCATASTALE='C593';
UPDATE T480_COMUNI T480 SET T480.CITTA='CHALLAND-SAINT-VICTOR' WHERE T480.CODCATASTALE='C594';
UPDATE T480_COMUNI T480 SET T480.CITTA='COCQUIO-TREVISAGO' WHERE T480.CODCATASTALE='C810';
UPDATE T480_COMUNI T480 SET T480.CITTA='COMEZZANO-CIZZAGO' WHERE T480.CODCATASTALE='C925';
UPDATE T480_COMUNI T480 SET T480.CITTA='CUGLIATE-FABIASCO' WHERE T480.CODCATASTALE='D199';
UPDATE T480_COMUNI T480 SET T480.CITTA='DUINO-AURISINA' WHERE T480.CODCATASTALE='D383';
UPDATE T480_COMUNI T480 SET T480.CITTA='FONDACHELLI-FANTINA' WHERE T480.CODCATASTALE='D661';
UPDATE T480_COMUNI T480 SET T480.CITTA='GIARDINI-NAXOS' WHERE T480.CODCATASTALE='E014';
UPDATE T480_COMUNI T480 SET T480.CITTA='GORNATE-OLONA' WHERE T480.CODCATASTALE='E104';
UPDATE T480_COMUNI T480 SET T480.CITTA='GRESSONEY-LA-TRINITE''' WHERE T480.CODCATASTALE='E167';
UPDATE T480_COMUNI T480 SET T480.CITTA='MALBORGHETTO-VALBRUNA' WHERE T480.CODCATASTALE='E847';
UPDATE T480_COMUNI T480 SET T480.CITTA='NAGO-TORBOLE' WHERE T480.CODCATASTALE='F835';
UPDATE T480_COMUNI T480 SET T480.CITTA='PONT-SAINT-MARTIN' WHERE T480.CODCATASTALE='G854';
UPDATE T480_COMUNI T480 SET T480.CITTA='PRE''-SAINT-DIDIER' WHERE T480.CODCATASTALE='H042';
UPDATE T480_COMUNI T480 SET T480.CITTA='RHEMES-NOTRE-DAME' WHERE T480.CODCATASTALE='H262';
UPDATE T480_COMUNI T480 SET T480.CITTA='RHEMES-SAINT-GEORGES' WHERE T480.CODCATASTALE='H263';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAINT-CHRISTOPHE' WHERE T480.CODCATASTALE='H669';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAINT-DENIS' WHERE T480.CODCATASTALE='H670';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAINT-MARCEL' WHERE T480.CODCATASTALE='H671';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAINT-NICOLAS' WHERE T480.CODCATASTALE='H672';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAINT-OYEN' WHERE T480.CODCATASTALE='H673';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAINT-PIERRE' WHERE T480.CODCATASTALE='H674';
UPDATE T480_COMUNI T480 SET T480.CITTA='SAINT-VINCENT' WHERE T480.CODCATASTALE='H676';
UPDATE T480_COMUNI T480 SET T480.CITTA='TRAVEDONA-MONATE' WHERE T480.CODCATASTALE='L342';
UPDATE T480_COMUNI T480 SET T480.CITTA='UGGIATE-TREVANO' WHERE T480.CODCATASTALE='L487';
UPDATE T480_COMUNI T480 SET T480.CITTA='RONZO-CHIENIS' WHERE T480.CODCATASTALE='M303';

-----
-- F24EP per utilizzare codice IRPEF anzichè codice regione
-----

declare
  i integer;
begin
  select COUNT(*) into i from P660_FLUSSIREGOLE t where t.Nome_Flusso='F24EP' and t.parte='E';
  if i > 0 then
     DELETE P660_FLUSSIREGOLE t where t.Nome_Flusso='F24EP' and t.parte='E';

insert into P660_FLUSSIREGOLE (nome_flusso, decorrenza, parte, numero, descrizione, tipo_record, sezione_file, numero_file, formato_file, lunghezza_file, formato_annomese, numerico, cod_arrotondamento, formato, ometti_vuoto, tipo_dato, regola_calcolo_automatica, regola_calcolo_manuale, regola_modificabile, commento, fl_numero_tredicesima, fl_numero_arrcorr, fl_numero_arrprec, nome_dato, codici_causali, fl_numero_tredprec)
values ('F24EP', to_date('01-01-2008', 'dd-mm-yyyy'), 'E', '001', 'IRPEF/IRAP prima parte', null, null, null, null, null, 'N', 'N', null, null, 'S', 'R', 
        'SELECT TIPO_RIGA, COD_TRIBUTO, COD_ENTE CODICE, '''' ESTREMI_IDENT,' || chr(10) || '       MESE RIFERIMENTO_A, ANNO RIFERIMENTO_B, COD_VOCE, COD_VOCE_SPECIALE, DESCRIZIONE,' || chr(10) || '       SUM(IMPORTO) IMPORTO FROM' || chr(10) || '(' || chr(10) || '-- IRPEF da competenze del mese' || chr(10) || 'SELECT ''01-IRPEF'' TIPO_TASSA, P441.PROGRESSIVO, ''F'' TIPO_RIGA,' || chr(10) || 'P200.COD_VOCE, P200.COD_VOCE_SPECIALE, P200.DESCRIZIONE,' || chr(10) || 'DECODE(P442.COD_VOCE||P442.COD_VOCE_SPECIALE,''11210BASE'',''100E'',''11220BASE'',''102E'',''11230BASE'',''110E'',''11520BASE'',''112E'',''11525BASE'',''145E'',''13160BASE'',''100E'',' || chr(10) || '       ''11500BASE'',DECODE(P430.COD_CAUSALEIRPEF,''1045'',''106E'',''104E''),' || chr(10) || '       ''11210CONG'',DECODE(SIGN(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'') - TO_CHAR(P442.DATA_COMPETENZA_A,''YYYY'')),1,''111E'',''100E''),' || chr(10) || '       ''13162CONG'',DECODE(SIGN(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'') - TO_CHAR(P442.DATA_COMPETENZA_A,''YYYY'')),1,''111E'',''100E'')) COD_TRIBUTO,' || chr(10) || ''''' COD_ENTE, ''00'' || TO_CHAR(P441.DATA_CEDOLINO,''MM'') MESE,' || chr(10) || 'DECODE(P442.COD_VOCE||P442.COD_VOCE_SPECIALE,' || chr(10) || '       ''11210CONG'',DECODE(SIGN(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'') - TO_CHAR(P442.DATA_COMPETENZA_A,''YYYY'')),' || chr(10) || '                          1,TO_NUMBER(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'')) - 1,TO_NUMBER(TO_CHAR(P441.DATA_CEDOLINO,''YYYY''))),' || chr(10) || '       ''13162CONG'',DECODE(SIGN(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'') - TO_CHAR(P442.DATA_COMPETENZA_A,''YYYY'')),' || chr(10) || '                          1,TO_NUMBER(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'')) - 1,TO_NUMBER(TO_CHAR(P441.DATA_CEDOLINO,''YYYY''))),' || chr(10) || '       TO_NUMBER(TO_CHAR(P441.DATA_CEDOLINO,''YYYY''))) ANNO,' || chr(10) || 'P442.IMPORTO * DECODE(P200.IMPORTO_COLONNA,''C'',-1,''R'',1) IMPORTO' || chr(10) || 'FROM P441_CEDOLINO P441, P442_CEDOLINOVOCI P442,' || chr(10) || '     P200_VOCI P200, P430_ANAGRAFICO P430' || chr(10) || 'WHERE P441.ID_CEDOLINO = P442.ID_CEDOLINO' || chr(10) || 'AND P441.PROGRESSIVO = P430.PROGRESSIVO AND P441.DATA_CEDOLINO BETWEEN P430.DECORRENZA AND P430.DECORRENZA_FINE' || chr(10) || 'AND P441.DATA_CEDOLINO = :DataElaborazione AND P441.CHIUSO IN (:StatoCedolini) AND P441.TIPO_CEDOLINO <> ''RP''' || chr(10) || 'AND P442.COD_VOCE||P442.COD_VOCE_SPECIALE IN (''11210BASE'',''11220BASE'',''11230BASE'',''11500BASE'',''11520BASE'',''11525BASE'',''13160BASE'',''11210CONG'',''13162CONG'')' || chr(10) || 'AND P442.TIPO_RECORD = ''M'' AND P200.ID_VOCE = P442.ID_VOCE' || chr(10) || 'UNION ALL' || chr(10) || '-- Addizionali IRPEF saldo e acconto' || chr(10) || 'SELECT ''01-IRPEF'' TIPO_TASSA, P441.PROGRESSIVO, DECODE(P258.TIPO_ADDIZIONALE,''R'',''R'',''C'',''S'') TIPO_RIGA,' || chr(10) || 'P200.COD_VOCE, P200.COD_VOCE_SPECIALE, P200.DESCRIZIONE,' || chr(10) || 'DECODE(P442.COD_VOCE,''11250'',''384E'',''11255'',''385E'',''11270'',''381E'') COD_TRIBUTO,' || chr(10) || 'DECODE(P258.TIPO_ADDIZIONALE,''R'',' || chr(10) || '       (SELECT T482.COD_IRPEF FROM T482_REGIONI T482 WHERE T482.COD_REGIONE=P258.COD_ENTE),' || chr(10) || '       P258.COD_ENTE) COD_ENTE,' || chr(10) || '''00'' || TO_CHAR(P441.DATA_CEDOLINO,''MM'') MESE, P258.ANNO, P442.IMPORTO' || chr(10) || 'FROM P441_CEDOLINO P441, P442_CEDOLINOVOCI P442,' || chr(10) || '     P200_VOCI P200, P258_ADDIZIONALIIRPEF P258' || chr(10) || 'WHERE P441.ID_CEDOLINO = P442.ID_CEDOLINO AND P441.PROGRESSIVO = P258.PROGRESSIVO' || chr(10) || 'AND P441.DATA_CEDOLINO = :DataElaborazione AND P441.CHIUSO IN (:StatoCedolini) AND P441.TIPO_CEDOLINO <> ''RP''' || chr(10) || 'AND P258.ANNO = TO_CHAR(P442.DATA_COMPETENZA_A,''YYYY'')' || chr(10) || 'AND P258.TIPO_ADDIZIONALE = DECODE(P442.COD_VOCE,''11250'',''C'',''11255'',''C'',''11270'',''R'')' || chr(10) || 'AND P258.TIPO_VERSAMENTO = DECODE(P442.COD_VOCE,''11250'',''S'',''11255'',''A'',''11270'',''S'')' || chr(10) || 'AND P442.COD_VOCE IN (''11250'',''11255'',''11270'')' || chr(10) || 'AND P442.COD_VOCE_SPECIALE = ''BASE'' AND P442.TIPO_RECORD = ''M'' AND P200.ID_VOCE = P442.ID_VOCE' || chr(10) || 'UNION ALL', 
        'SELECT TIPO_RIGA, COD_TRIBUTO, COD_ENTE CODICE, '''' ESTREMI_IDENT,' || chr(10) || '       MESE RIFERIMENTO_A, ANNO RIFERIMENTO_B, COD_VOCE, COD_VOCE_SPECIALE, DESCRIZIONE,' || chr(10) || '       SUM(IMPORTO) IMPORTO FROM' || chr(10) || '(' || chr(10) || '-- IRPEF da competenze del mese' || chr(10) || 'SELECT ''01-IRPEF'' TIPO_TASSA, P441.PROGRESSIVO, ''F'' TIPO_RIGA,' || chr(10) || 'P200.COD_VOCE, P200.COD_VOCE_SPECIALE, P200.DESCRIZIONE,' || chr(10) || 'DECODE(P442.COD_VOCE||P442.COD_VOCE_SPECIALE,''11210BASE'',''100E'',''11220BASE'',''102E'',''11230BASE'',''110E'',''11520BASE'',''112E'',''11525BASE'',''145E'',''13160BASE'',''100E'',' || chr(10) || '       ''11500BASE'',DECODE(P430.COD_CAUSALEIRPEF,''1045'',''106E'',''104E''),' || chr(10) || '       ''11210CONG'',DECODE(SIGN(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'') - TO_CHAR(P442.DATA_COMPETENZA_A,''YYYY'')),1,''111E'',''100E''),' || chr(10) || '       ''13162CONG'',DECODE(SIGN(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'') - TO_CHAR(P442.DATA_COMPETENZA_A,''YYYY'')),1,''111E'',''100E'')) COD_TRIBUTO,' || chr(10) || ''''' COD_ENTE, ''00'' || TO_CHAR(P441.DATA_CEDOLINO,''MM'') MESE,' || chr(10) || 'DECODE(P442.COD_VOCE||P442.COD_VOCE_SPECIALE,' || chr(10) || '       ''11210CONG'',DECODE(SIGN(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'') - TO_CHAR(P442.DATA_COMPETENZA_A,''YYYY'')),' || chr(10) || '                          1,TO_NUMBER(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'')) - 1,TO_NUMBER(TO_CHAR(P441.DATA_CEDOLINO,''YYYY''))),' || chr(10) || '       ''13162CONG'',DECODE(SIGN(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'') - TO_CHAR(P442.DATA_COMPETENZA_A,''YYYY'')),' || chr(10) || '                          1,TO_NUMBER(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'')) - 1,TO_NUMBER(TO_CHAR(P441.DATA_CEDOLINO,''YYYY''))),' || chr(10) || '       TO_NUMBER(TO_CHAR(P441.DATA_CEDOLINO,''YYYY''))) ANNO,' || chr(10) || 'P442.IMPORTO * DECODE(P200.IMPORTO_COLONNA,''C'',-1,''R'',1) IMPORTO' || chr(10) || 'FROM P441_CEDOLINO P441, P442_CEDOLINOVOCI P442,' || chr(10) || '     P200_VOCI P200, P430_ANAGRAFICO P430' || chr(10) || 'WHERE P441.ID_CEDOLINO = P442.ID_CEDOLINO' || chr(10) || 'AND P441.PROGRESSIVO = P430.PROGRESSIVO AND P441.DATA_CEDOLINO BETWEEN P430.DECORRENZA AND P430.DECORRENZA_FINE' || chr(10) || 'AND P441.DATA_CEDOLINO = :DataElaborazione AND P441.CHIUSO IN (:StatoCedolini) AND P441.TIPO_CEDOLINO <> ''RP''' || chr(10) || 'AND P442.COD_VOCE||P442.COD_VOCE_SPECIALE IN (''11210BASE'',''11220BASE'',''11230BASE'',''11500BASE'',''11520BASE'',''11525BASE'',''13160BASE'',''11210CONG'',''13162CONG'')' || chr(10) || 'AND P442.TIPO_RECORD = ''M'' AND P200.ID_VOCE = P442.ID_VOCE' || chr(10) || 'UNION ALL' || chr(10) || '-- Addizionali IRPEF saldo e acconto' || chr(10) || 'SELECT ''01-IRPEF'' TIPO_TASSA, P441.PROGRESSIVO, DECODE(P258.TIPO_ADDIZIONALE,''R'',''R'',''C'',''S'') TIPO_RIGA,' || chr(10) || 'P200.COD_VOCE, P200.COD_VOCE_SPECIALE, P200.DESCRIZIONE,' || chr(10) || 'DECODE(P442.COD_VOCE,''11250'',''384E'',''11255'',''385E'',''11270'',''381E'') COD_TRIBUTO,' || chr(10) || 'DECODE(P258.TIPO_ADDIZIONALE,''R'',' || chr(10) || '       (SELECT T482.COD_IRPEF FROM T482_REGIONI T482 WHERE T482.COD_REGIONE=P258.COD_ENTE),' || chr(10) || '       P258.COD_ENTE) COD_ENTE,' || chr(10) || '''00'' || TO_CHAR(P441.DATA_CEDOLINO,''MM'') MESE, P258.ANNO, P442.IMPORTO' || chr(10) || 'FROM P441_CEDOLINO P441, P442_CEDOLINOVOCI P442,' || chr(10) || '     P200_VOCI P200, P258_ADDIZIONALIIRPEF P258' || chr(10) || 'WHERE P441.ID_CEDOLINO = P442.ID_CEDOLINO AND P441.PROGRESSIVO = P258.PROGRESSIVO' || chr(10) || 'AND P441.DATA_CEDOLINO = :DataElaborazione AND P441.CHIUSO IN (:StatoCedolini) AND P441.TIPO_CEDOLINO <> ''RP''' || chr(10) || 'AND P258.ANNO = TO_CHAR(P442.DATA_COMPETENZA_A,''YYYY'')' || chr(10) || 'AND P258.TIPO_ADDIZIONALE = DECODE(P442.COD_VOCE,''11250'',''C'',''11255'',''C'',''11270'',''R'')' || chr(10) || 'AND P258.TIPO_VERSAMENTO = DECODE(P442.COD_VOCE,''11250'',''S'',''11255'',''A'',''11270'',''S'')' || chr(10) || 'AND P442.COD_VOCE IN (''11250'',''11255'',''11270'')' || chr(10) || 'AND P442.COD_VOCE_SPECIALE = ''BASE'' AND P442.TIPO_RECORD = ''M'' AND P200.ID_VOCE = P442.ID_VOCE' || chr(10) || 'UNION ALL', 
        'N', null, null, null, null, null, null, null);
insert into P660_FLUSSIREGOLE (nome_flusso, decorrenza, parte, numero, descrizione, tipo_record, sezione_file, numero_file, formato_file, lunghezza_file, formato_annomese, numerico, cod_arrotondamento, formato, ometti_vuoto, tipo_dato, regola_calcolo_automatica, regola_calcolo_manuale, regola_modificabile, commento, fl_numero_tredicesima, fl_numero_arrcorr, fl_numero_arrprec, nome_dato, codici_causali, fl_numero_tredprec)
values ('F24EP', to_date('01-01-2008', 'dd-mm-yyyy'), 'E', '002', 'IRPEF/IRAP seconda parte', null, null, null, null, null, 'N', 'N', null, null, 'S', 'R', 
        '-- IRPEF da modello 730' || chr(10) || 'SELECT ''01-IRPEF'' TIPO_TASSA, P441.PROGRESSIVO, DECODE(P260.TIPO_ENTE,''N'',''F'',''R'',''R'',''C'',''S'') TIPO_RIGA,' || chr(10) || 'P200.COD_VOCE, P200.COD_VOCE_SPECIALE, P200.DESCRIZIONE,' || chr(10) || 'SUBSTR(P200.COD_CAUSALEIRPEF,4) COD_TRIBUTO,' || chr(10) || 'P264.COD_ENTE, ''00'' || TO_CHAR(P441.DATA_CEDOLINO,''MM'') MESE,' || chr(10) || 'P260.ANNO + P260.ANNO_IMPOSTA ANNO,' || chr(10) || 'P442.IMPORTO * DECODE(P200.IMPORTO_COLONNA,''C'',-1,''R'',1) IMPORTO' || chr(10) || 'FROM P441_CEDOLINO P441, P442_CEDOLINOVOCI P442, P200_VOCI P200,' || chr(10) || '     P260_MOD730TIPOIMPORTI P260, P264_MOD730IMPORTI P264,' || chr(10) || '     T480_COMUNI T480, T482_REGIONI T482' || chr(10) || 'WHERE P441.ID_CEDOLINO = P442.ID_CEDOLINO' || chr(10) || 'AND P441.DATA_CEDOLINO = :DataElaborazione AND P441.CHIUSO IN (:StatoCedolini) AND P441.TIPO_CEDOLINO <> ''RP''' || chr(10) || 'AND P442.TIPO_RECORD = ''M'' AND P200.ID_VOCE = P442.ID_VOCE AND' || chr(10) || '(' || chr(10) || '(P442.COD_VOCE = P260.COD_VOCE AND' || chr(10) || 'P442.COD_VOCE_SPECIALE = P260.COD_VOCE_SPECIALE) OR' || chr(10) || '(P442.COD_VOCE = P260.COD_VOCE_INT_RATE AND' || chr(10) || 'P442.COD_VOCE_SPECIALE = P260.COD_VOCE_SPECIALE_INT_RATE) OR' || chr(10) || '(P442.COD_VOCE = P260.COD_VOCE_INT_RITARDO AND' || chr(10) || 'P442.COD_VOCE_SPECIALE = P260.COD_VOCE_SPECIALE_INT_RITARDO)' || chr(10) || ') AND' || chr(10) || 'TO_CHAR(P442.DATA_COMPETENZA_A,''YYYY'') = P260.ANNO AND' || chr(10) || 'P260.ANNO = P264.ANNO AND P260.COD_TIPOIMPORTO = P264.COD_TIPOIMPORTO AND' || chr(10) || 'P264.PROGRESSIVO = P441.PROGRESSIVO AND' || chr(10) || 'P264.COD_ENTE = T480.CODCATASTALE(+) AND P264.COD_ENTE = T482.COD_REGIONE(+)' || chr(10) || 'UNION ALL' || chr(10) || '-- IRAP' || chr(10) || 'SELECT ''02-IRAP'' TIPO_TASSA, P441.PROGRESSIVO, ''R'' TIPO_RIGA,' || chr(10) || 'P200.COD_VOCE, P200.COD_VOCE_SPECIALE, P200.DESCRIZIONE,' || chr(10) || '''380E'' COD_TRIBUTO,' || chr(10) || '  (SELECT T482.COD_IRPEF FROM P500_CUDSETUP P500, T481_PROVINCE T481, T482_REGIONI T482' || chr(10) || '     WHERE P500.ANNO = TO_CHAR(P441.DATA_CEDOLINO,''YYYY'') AND P500.PROVINCIA = T481.COD_PROVINCIA' || chr(10) || '     AND T481.COD_REGIONE = T482.COD_REGIONE)' || chr(10) || '  COD_ENTE,' || chr(10) || '''00'' || TO_CHAR(P441.DATA_CEDOLINO,''MM'') MESE,' || chr(10) || 'TO_NUMBER(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'')) ANNO,' || chr(10) || 'P442.IMPORTO' || chr(10) || 'FROM P441_CEDOLINO P441, P442_CEDOLINOVOCI P442, P200_VOCI P200' || chr(10) || 'WHERE P441.ID_CEDOLINO = P442.ID_CEDOLINO' || chr(10) || 'AND P441.DATA_CEDOLINO = :DataElaborazione AND P441.CHIUSO IN (:StatoCedolini) AND P441.TIPO_CEDOLINO <> ''RP''' || chr(10) || 'AND P442.COD_VOCE IN (''11100'',''11102'')' || chr(10) || 'AND P442.COD_VOCE_SPECIALE = ''BASE'' AND P442.TIPO_RECORD = ''M'' AND P200.ID_VOCE = P442.ID_VOCE' || chr(10) || ')' || chr(10) || 'WHERE PROGRESSIVO IN (SELECT PROGRESSIVO FROM :C700SelAnagrafe)' || chr(10) || 'GROUP BY TIPO_TASSA, TIPO_RIGA, COD_TRIBUTO, COD_ENTE, MESE, ANNO, COD_VOCE, COD_VOCE_SPECIALE, DESCRIZIONE' || chr(10) || 'HAVING SUM(IMPORTO) <> 0' || chr(10) || 'ORDER BY TIPO_TASSA, TIPO_RIGA, COD_ENTE, COD_TRIBUTO, ANNO, COD_VOCE, COD_VOCE_SPECIALE, DESCRIZIONE' || chr(10) || '', 
        '-- IRPEF da modello 730' || chr(10) || 'SELECT ''01-IRPEF'' TIPO_TASSA, P441.PROGRESSIVO, DECODE(P260.TIPO_ENTE,''N'',''F'',''R'',''R'',''C'',''S'') TIPO_RIGA,' || chr(10) || 'P200.COD_VOCE, P200.COD_VOCE_SPECIALE, P200.DESCRIZIONE,' || chr(10) || 'SUBSTR(P200.COD_CAUSALEIRPEF,4) COD_TRIBUTO,' || chr(10) || 'P264.COD_ENTE, ''00'' || TO_CHAR(P441.DATA_CEDOLINO,''MM'') MESE,' || chr(10) || 'P260.ANNO + P260.ANNO_IMPOSTA ANNO,' || chr(10) || 'P442.IMPORTO * DECODE(P200.IMPORTO_COLONNA,''C'',-1,''R'',1) IMPORTO' || chr(10) || 'FROM P441_CEDOLINO P441, P442_CEDOLINOVOCI P442, P200_VOCI P200,' || chr(10) || '     P260_MOD730TIPOIMPORTI P260, P264_MOD730IMPORTI P264,' || chr(10) || '     T480_COMUNI T480, T482_REGIONI T482' || chr(10) || 'WHERE P441.ID_CEDOLINO = P442.ID_CEDOLINO' || chr(10) || 'AND P441.DATA_CEDOLINO = :DataElaborazione AND P441.CHIUSO IN (:StatoCedolini) AND P441.TIPO_CEDOLINO <> ''RP''' || chr(10) || 'AND P442.TIPO_RECORD = ''M'' AND P200.ID_VOCE = P442.ID_VOCE AND' || chr(10) || '(' || chr(10) || '(P442.COD_VOCE = P260.COD_VOCE AND' || chr(10) || 'P442.COD_VOCE_SPECIALE = P260.COD_VOCE_SPECIALE) OR' || chr(10) || '(P442.COD_VOCE = P260.COD_VOCE_INT_RATE AND' || chr(10) || 'P442.COD_VOCE_SPECIALE = P260.COD_VOCE_SPECIALE_INT_RATE) OR' || chr(10) || '(P442.COD_VOCE = P260.COD_VOCE_INT_RITARDO AND' || chr(10) || 'P442.COD_VOCE_SPECIALE = P260.COD_VOCE_SPECIALE_INT_RITARDO)' || chr(10) || ') AND' || chr(10) || 'TO_CHAR(P442.DATA_COMPETENZA_A,''YYYY'') = P260.ANNO AND' || chr(10) || 'P260.ANNO = P264.ANNO AND P260.COD_TIPOIMPORTO = P264.COD_TIPOIMPORTO AND' || chr(10) || 'P264.PROGRESSIVO = P441.PROGRESSIVO AND' || chr(10) || 'P264.COD_ENTE = T480.CODCATASTALE(+) AND P264.COD_ENTE = T482.COD_REGIONE(+)' || chr(10) || 'UNION ALL' || chr(10) || '-- IRAP' || chr(10) || 'SELECT ''02-IRAP'' TIPO_TASSA, P441.PROGRESSIVO, ''R'' TIPO_RIGA,' || chr(10) || 'P200.COD_VOCE, P200.COD_VOCE_SPECIALE, P200.DESCRIZIONE,' || chr(10) || '''380E'' COD_TRIBUTO,' || chr(10) || '  (SELECT T482.COD_IRPEF FROM P500_CUDSETUP P500, T481_PROVINCE T481, T482_REGIONI T482' || chr(10) || '     WHERE P500.ANNO = TO_CHAR(P441.DATA_CEDOLINO,''YYYY'') AND P500.PROVINCIA = T481.COD_PROVINCIA' || chr(10) || '     AND T481.COD_REGIONE = T482.COD_REGIONE)' || chr(10) || '  COD_ENTE,' || chr(10) || '''00'' || TO_CHAR(P441.DATA_CEDOLINO,''MM'') MESE,' || chr(10) || 'TO_NUMBER(TO_CHAR(P441.DATA_CEDOLINO,''YYYY'')) ANNO,' || chr(10) || 'P442.IMPORTO' || chr(10) || 'FROM P441_CEDOLINO P441, P442_CEDOLINOVOCI P442, P200_VOCI P200' || chr(10) || 'WHERE P441.ID_CEDOLINO = P442.ID_CEDOLINO' || chr(10) || 'AND P441.DATA_CEDOLINO = :DataElaborazione AND P441.CHIUSO IN (:StatoCedolini) AND P441.TIPO_CEDOLINO <> ''RP''' || chr(10) || 'AND P442.COD_VOCE IN (''11100'',''11102'')' || chr(10) || 'AND P442.COD_VOCE_SPECIALE = ''BASE'' AND P442.TIPO_RECORD = ''M'' AND P200.ID_VOCE = P442.ID_VOCE' || chr(10) || ')' || chr(10) || 'WHERE PROGRESSIVO IN (SELECT PROGRESSIVO FROM :C700SelAnagrafe)' || chr(10) || 'GROUP BY TIPO_TASSA, TIPO_RIGA, COD_TRIBUTO, COD_ENTE, MESE, ANNO, COD_VOCE, COD_VOCE_SPECIALE, DESCRIZIONE' || chr(10) || 'HAVING SUM(IMPORTO) <> 0' || chr(10) || 'ORDER BY TIPO_TASSA, TIPO_RIGA, COD_ENTE, COD_TRIBUTO, ANNO, COD_VOCE, COD_VOCE_SPECIALE, DESCRIZIONE' || chr(10) || '', 
        'N', null, null, null, null, null, null, null);

  end if;
end;
/


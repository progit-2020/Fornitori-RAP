create or replace procedure I000P_ELIMINAVECCHILOG is  cursor c1(INANNO INTEGER) is    select I000.ID, I000.ROWID      from I000_LOGINFO I000     where I000.DATA < add_months(trunc(SYSDATE,'yyyy'),-12 * INANNO);  PERIODO integer;  CCOMMIT integer;  ECCEZIONE varchar(2000);begin  PERIODO:=99;  begin    select nvl(I091.DATO,99) into PERIODO      from MONDOEDP.I091_DATIENTE I091     where I091.AZIENDA = T000F_GETAZIENDACORRENTE       and I091.TIPO = 'C28_CANCELLA_ANNO_LOG';  exception    when NO_DATA_FOUND then      null;  end;  if PERIODO < 99 then    begin      insert into MONDOEDP.I021_LOG_JOB(DATAORA,MESSAGGIO,AZIENDA,TIPO) values(sysdate,'Inizio elaborazione',T000F_GETAZIENDACORRENTE,'I000P_ELIMINAVECCHILOG');      CCOMMIT:=1;      for t1 in c1(PERIODO) loop        insert into I000_BACKUP (ID, OPERATORE, DATA, MASCHERA, TABELLA, OPERAZIONE) select ID, OPERATORE, DATA, MASCHERA, TABELLA, OPERAZIONE from I000_LOGINFO where ROWID = T1.ROWID;        insert into I001_BACKUP (ID, COLONNA, VALORE_OLD, VALORE_NEW) select ID, COLONNA, VALORE_OLD, VALORE_NEW from I001_LOGDATI where ID = T1.ID;        delete from I001_LOGDATI where ID = T1.ID;        delete from I000_LOGINFO where ROWID = T1.ROWID;        if mod(CCOMMIT,500) = 0 then          commit;        end if;           CCOMMIT:=CCOMMIT + 1;      end loop;        insert into MONDOEDP.I021_LOG_JOB(DATAORA,MESSAGGIO,AZIENDA,TIPO) values(sysdate, 'Fine elaborazione - eliminati '||to_char(CCOMMIT - 1)||' record.',T000F_GETAZIENDACORRENTE,'I000P_ELIMINAVECCHILOG');    exception      when others then        ECCEZIONE:=substr(SQLERRM,1,2000);        insert into MONDOEDP.I021_LOG_JOB(DATAORA,MESSAGGIO,AZIENDA,TIPO)        values(sysdate, ECCEZIONE, T000F_GETAZIENDACORRENTE,'I000P_ELIMINAVECCHILOG');    end;    commit;    end if;  end I000P_ELIMINAVECCHILOG;/grant execute on I000P_ELIMINAVECCHILOG to MONDOEDP/*--NOLOG--*/;
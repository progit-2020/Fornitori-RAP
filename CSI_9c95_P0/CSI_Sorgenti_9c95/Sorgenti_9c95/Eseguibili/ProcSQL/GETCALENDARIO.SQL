CREATE OR REPLACE PROCEDURE GETCALENDARIO(PROG IN NUMBER, D IN DATE, F OUT VARCHAR2, L OUT VARCHAR2, G OUT INTEGER, MONTEORE OUT VARCHAR2) AS
CALEND VARCHAR2(5);
BEGIN
  SELECT ORARIO,CALENDARIO INTO MONTEORE,CALEND
    FROM T430_STORICO WHERE PROGRESSIVO = PROG AND D BETWEEN DATADECORRENZA AND DATAFINE;
  BEGIN
    SELECT FESTIVO,LAVORATIVO, NUMGIORNI
      INTO F,L,G
      FROM T012_CALENDINDIVID WHERE PROGRESSIVO = PROG AND DATA = D;
  EXCEPTION
    WHEN NO_DATA_FOUND THEN
      SELECT FESTIVO,LAVORATIVO, NUMGIORNI 
        INTO F,L,G
        FROM T011_CALENDARI WHERE CODICE = CALEND AND DATA = D;
  END;
EXCEPTION
  WHEN NO_DATA_FOUND THEN
    L:='';
    F:='';
    G:=0;
END;
/
